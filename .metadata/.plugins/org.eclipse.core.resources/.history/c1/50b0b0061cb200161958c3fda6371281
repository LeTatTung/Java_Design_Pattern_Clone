package com.letattung.caching;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class CacheStore {

	private static final Logger LOGGER = LoggerFactory.getLogger(CacheStore.class);
	static LruCache cache;
	private CacheStore(){
		
	}
	// int cache capacity
	public static void intCapacity(int capacity){
		if(cache == null){
			cache = new LruCache(capacity);
		}else{
			cache.setCapacity(capacity);
		}
	}
	 //Get user account using read-through cache
	 public static UserAccount readThrough(String userId){
		if(cache.contains(userId)){
			LOGGER.info("#Cache Hit#");
			return cache.get(userId);
		} 
		LOGGER.info("# Cache Miss!");
	    UserAccount userAccount = DbManager.readFromDb(userId);
	    cache.set(userId, userAccount);
	    return userAccount;
	 }
	 
	 //get user account using write-though cache
	 public static void writeThrough(UserAccount userAccount){
		 if(cache.contains(userAccount.getUserId())){
			 DbManager.updateDb(userAccount);
		 }else{
			 DbManager.writeToDb(userAccount);
		 }
		 cache.set(userAccount.getUserId(), userAccount);
	 }
	 
	 //get user account using write-around cache
	 public static void writeAround(UserAccount userAccount){
		 if(cache.contains(userAccount.getUserId())){
			 DbManager.updateDb(userAccount);
			 cache.invalidate(userAccount.getUserId());
		 }else{
			 DbManager.writeToDb(userAccount);
		 }
	 }
	 
	 //Get user account using read-through cache with write-back policy
	 public static UserAccount readThroughWithWriteBackPolicy(String userId){
		 if(cache.contains(userId)){
			System.out.println("# Cache Hit!");
			return cache.get(userId);
		 }
		 System.out.println("# Cache Miss!");
		 UserAccount userAccount = DbManager.readFromDb(userId);
		 if(cache.isFull()){
			 System.out.println("# Cache is FULL! Writing LRU data to DB...");
			 UserAccount toBeWrittenToDb = cache.getLruData();
			 DbManager.upsertDb(toBeWrittenToDb);
		 }
		 cache.set(userId, userAccount);
		 return userAccount;
	 }
}
